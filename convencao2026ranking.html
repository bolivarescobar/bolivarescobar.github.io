<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conven√ß√£o Educacional 2026 | Pontua√ß√£o</title>

  <style>
    :root{
      --bg1:#f8fafc;
      --bg2:#e0f2fe;
      --panel: rgba(255,255,255,0.92);
      --text:#0f172a;
      --muted:#475569;
      --accent:#0284c7;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:
        radial-gradient(1100px 550px at 20% 10%, rgba(56,189,248,0.35) 0%, transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
    }

    .app{
      width:100vw;
      height:100vh;
      padding:14px;
      display:grid;
      grid-template-rows: auto 1fr;
      gap:14px;
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      min-width:0;
    }

    h1{
      margin:0;
      font-size: clamp(18px, 2.2vw, 26px);
      line-height:1.15;
    }
    .hint{
      margin:6px 0 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.04);
      border: 1px solid rgba(15,23,42,0.12);
      font-size: 13px;
      color: rgba(15,23,42,0.70);
      white-space: nowrap;
    }

    .card{
      background: var(--panel);
      border: 1px solid rgba(15,23,42,0.12);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 18px 50px rgba(15,23,42,0.14);
      backdrop-filter: blur(8px);
      min-height:0;
    }

    .layout{
      height:100%;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:14px;
      min-height:0;
    }

    @media (max-width: 980px){
      .layout{
        grid-template-columns: 1fr;
        grid-template-rows: minmax(320px, 1fr) auto;
      }
    }

    .scene{
      padding:0;
      overflow:hidden;
      height:100%;
      min-height:0;
    }

    svg{
      width:100%;
      height:100%;
      display:block;
    }

    .controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
      min-height:0;
    }

    .controls-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(15,23,42,0.14);
      background: rgba(255,255,255,0.75);
      color: rgba(15,23,42,0.85);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{
      border-color: rgba(2,132,199,0.35);
      box-shadow: 0 0 0 3px rgba(2,132,199,0.10);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .team-card{
      border: 1px solid rgba(15,23,42,0.10);
      background: rgba(255,255,255,0.75);
      border-radius: 14px;
      padding:10px;
      display:grid;
      gap:8px;
    }

    .team-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .team-name{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .dot{
      width:12px;
      height:12px;
      border-radius:999px;
      background: var(--accent);
      flex: 0 0 auto;
      border: 1px solid rgba(15,23,42,0.12);
    }

    .team-title{
      font-weight:800;
      font-size: 13px;
      color: rgba(15,23,42,0.85);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .team-score{
      display:flex;
      align-items:baseline;
      gap:8px;
      color: rgba(15,23,42,0.75);
      font-size: 12px;
      white-space: nowrap;
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    input[type="number"]{
      width: 110px;
      padding:9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,0.16);
      background: rgba(255,255,255,0.9);
      color: var(--text);
      outline:none;
    }

    input[type="range"]{
      width: 100%;
      accent-color: var(--accent);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      line-height:1.3;
    }

    /* Bot√£o "soltar fogos" (canto superior direito) */
.fireworks-btn{
  position: fixed;
  top: 14px;
  right: 14px;
  z-index: 9999;

  appearance: none;
  border: 1px solid rgba(15,23,42,0.16);
  background: rgba(255,255,255,0.82);
  color: rgba(15,23,42,0.88);
  padding: 10px 12px;
  border-radius: 14px;
  cursor: pointer;
  font-weight: 800;
  font-size: 13px;
  box-shadow: 0 12px 30px rgba(15,23,42,0.14);
  backdrop-filter: blur(8px);
}

.fireworks-btn:hover{
  border-color: rgba(2,132,199,0.35);
  box-shadow: 0 0 0 3px rgba(2,132,199,0.12), 0 12px 30px rgba(15,23,42,0.14);
}

.fireworks-btn:active{
  transform: translateY(1px);
}

/* Canvas dos fogos (overlay na tela toda) */
#fireworksCanvas{
  position: fixed;
  inset: 0;
  z-index: 9998;
  pointer-events: none; /* n√£o atrapalha cliques */
}

  </style>
</head>

<body>
  <div class="app">
    <header>
      <div style="min-width:0">
        <h1>Conven√ß√£o Educacional 2026 | Pontua√ß√£o</h1>
        <p class="hint"></p>
      </div>
      <div class="badge" id="summaryBadge">üèÅ 13 equipes ativas</div>
      <button class="fireworks-btn" id="btnFireworks" type="button">SOLTAR FOGOS!</button>
      <canvas id="fireworksCanvas"></canvas>

    </header>

    <div class="layout">
      <!-- CENA -->
      <section class="card scene" aria-label="Pista de corrida horizontal">
        <svg viewBox="0 0 1100 620" preserveAspectRatio="xMidYMid meet" role="img"
             aria-label="Pista com 13 raias e 13 personagens avan√ßando conforme pontua√ß√£o">
          <defs>
            <linearGradient id="trackBg" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="rgba(15,23,42,0.05)"></stop>
              <stop offset="100%" stop-color="rgba(15,23,42,0.02)"></stop>
            </linearGradient>

            <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
              <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity="0.18"/>
            </filter>
          </defs>

          <!-- fundo da cena -->
          <rect x="0" y="0" width="1100" height="620" fill="rgba(255,255,255,0.55)"></rect>

          <!-- ‚Äúpista‚Äù -->
          <rect x="60" y="60" width="980" height="500" rx="18" fill="url(#trackBg)" stroke="rgba(15,23,42,0.10)" />

          <!-- linha de largada / chegada -->
          <g opacity="0.95">
            <!-- start -->
            <rect x="120" y="80" width="10" height="460" fill="rgba(15,23,42,0.18)"/>
            <text x="125" y="70" text-anchor="middle" font-size="14" fill="rgba(15,23,42,0.55)">IN√çCIO</text>

            <!-- finish -->
            <rect x="980" y="80" width="10" height="460" fill="rgba(15,23,42,0.18)"/>
            <text x="985" y="70" text-anchor="middle" font-size="14" fill="rgba(15,23,42,0.55)"></text>
          </g>

          <!-- marca√ß√µes leves no ch√£o -->
          <g opacity="0.6">
            <!-- a cada 50 pontos (0..300) -->
            <g id="distanceTicks"></g>
          </g>

          <!-- Raias (linhas horizontais) -->
          <g id="lanes" opacity="0.85"></g>

          <!-- Paths individuais (um por equipe) -->
          <g id="paths" opacity="0.0"></g>

          <g id="tracksDone"></g>

          <!-- Corredores (13) -->
          <g id="runners"></g>
        </svg>
      </section>

      <!-- CONTROLES -->
      <aside class="card controls" aria-label="Controles de pontua√ß√£o por equipe">
        <div class="controls-top">
          <div class="badge">üéØ Intervalo: 0‚Äì300</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" id="btnZero">Zerar tudo</button>
            <button class="btn" id="btnRandom">Aleat√≥rio</button>
          </div>
        </div>

        <div class="small">
          Dica: o movimento √© suavizado (anima√ß√£o). Voc√™ pode digitar valores ou usar os sliders.
        </div>

        <div class="grid" id="teamControls"></div>
      </aside>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const TEAMS = 13;
    const MIN_SCORE = 0;
    const MAX_SCORE = 300;
    const TEAM_NAMES = [
  "Equipe 1 - 103 M",
  "Equipe 2 - PROJETO GOI√ÅS",
  "Equipe 3 - COL√âGIO MILITAR SP",
  "Equipe 4 - 3200 Professores Formados",
  "Equipe 5 - ATIVA O SININHO",
  "Equipe 6 - EDU SUPORTE",
  "Equipe 7 - MINHA ESCOLA",
  "Equipe 8 - PROJETOS IA",
  "Equipe 9 - Rede de Formadores",
  "Equipe 10 - REPLAN",
  "Equipe 11 - TCV 18M",
  "Equipe 12 - INVENTURA PR",
  "Equipe 13 - MICRO:BIT S√ÉO PAULO"
];

    // Pista (coordenadas no SVG)
    const X_START = 125;  // posi√ß√£o do path (um pouco ap√≥s a linha IN√çCIO)
    const X_END   = 985;  // posi√ß√£o do path (em cima da linha CHEGADA)
    const Y_TOP   = 100;
    const Y_SPACING = 36; // espa√ßamento entre raias

    // Cores (uma por equipe)
    const COLORS = [
      "#5cb1ff", "#1be746", "#ea580c", "#7c3aed", "#dc2626",
      "#bcbcbc", "#ca8a04", "#444444", "#ff63fa", "#73410e",
      "#ffffff", "#294acc", "#006c17"
    ];

    // =========================
    // HELPERS
    // =========================
    const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

    function scoreToProgress(score){
      return clamp(score, MIN_SCORE, MAX_SCORE) / MAX_SCORE; // 0..1
    }

    // Gera um path ‚Äúquase reto‚Äù, mas com leve ondula√ß√£o diferente por equipe
    // (mant√©m ‚Äútrajeto individual‚Äù sem perder leitura horizontal)
    function buildLanePathD(i){
      const y = Y_TOP + i * Y_SPACING;
      const amp = 6 + (i % 3) * 2;       // amplitude pequena
      const k1 = (i % 5) * 10;
      const k2 = (i % 7) * 8;

      // Bezier em 3 segmentos
      // come√ßa em X_START e termina em X_END, com pequenas varia√ß√µes de y
      return `
        M ${X_START} ${y}
        C ${X_START + 180} ${y + amp}, ${X_START + 260} ${y - amp}, ${X_START + 360} ${y + (amp/2)}
        C ${X_START + 520} ${y + (amp/2) + (k1?1:-1)}, ${X_START + 650} ${y - (amp/2)}, ${X_START + 780} ${y + (amp/2) - (k2?1:-1)}
        C ${X_START + 860} ${y - amp}, ${X_END - 120} ${y + amp}, ${X_END} ${y}
      `.trim();
    }

    // Desenha um ‚Äúminifigure‚Äù simples (tipo LEGO) como SVG string (sem imagens externas)
    function minifigSVG(color){
      // Observa√ß√£o: n√£o usamos logo/marca; √© um estilo ‚Äúminifigure‚Äù.
      return `
        <g>
          <ellipse cx="0" cy="-1" rx="14" ry="5" fill="rgba(0,0,0,0.14)"></ellipse>

          <!-- corpo -->
          <g transform="translate(0,-6)">
            <!-- mochila -->
            <rect x="-18" y="-32" width="36" height="22" rx="7"
                  fill="rgba(120,53,15,0.35)" stroke="rgba(0,0,0,0.12)" stroke-width="1"/>

            <!-- pernas -->
            <rect x="-14" y="-14" width="13" height="18" rx="3"
                  fill="rgba(30,64,175,0.55)" stroke="rgba(0,0,0,0.12)" stroke-width="1"/>
            <rect x="1" y="-14" width="13" height="18" rx="3"
                  fill="rgba(30,64,175,0.55)" stroke="rgba(0,0,0,0.12)" stroke-width="1"/>
            <rect x="-14" y="2" width="13" height="4" rx="2" fill="rgba(15,23,42,0.30)"/>
            <rect x="1" y="2" width="13" height="4" rx="2" fill="rgba(15,23,42,0.30)"/>

            <!-- tronco -->
            <rect x="-15" y="-32" width="30" height="18" rx="6"
                  fill="${color}" stroke="rgba(0,0,0,0.12)" stroke-width="1"/>
            <path d="M -10 -30 L -10 -15" stroke="rgba(255,255,255,0.28)" stroke-width="3" stroke-linecap="round"/>
            <path d="M 10 -30 L 10 -15"  stroke="rgba(255,255,255,0.28)" stroke-width="3" stroke-linecap="round"/>

            <!-- bra√ßos -->
            <g transform="translate(-19,-30) rotate(10)">
              <rect x="-4" y="0" width="8" height="16" rx="4" fill="${color}" opacity="0.85"/>
              <circle cx="0" cy="16" r="5" fill="rgba(246,208,77,0.92)" stroke="rgba(0,0,0,0.10)" stroke-width="1"/>
            </g>
            <g transform="translate(19,-30) rotate(-10)">
              <rect x="-4" y="0" width="8" height="16" rx="4" fill="${color}" opacity="0.85"/>
              <circle cx="0" cy="16" r="5" fill="rgba(246,208,77,0.92)" stroke="rgba(0,0,0,0.10)" stroke-width="1"/>
            </g>

            <!-- cabe√ßa -->
            <rect x="-12" y="-52" width="24" height="18" rx="7"
                  fill="rgba(246,208,77,0.98)" stroke="rgba(0,0,0,0.12)" stroke-width="1"/>
            <ellipse cx="0" cy="-54" rx="7" ry="3.6" fill="rgba(246,208,77,0.72)"/>
            <circle cx="-5" cy="-44" r="2.1" fill="rgba(15,23,42,0.75)"/>
            <circle cx="5"  cy="-44" r="2.1" fill="rgba(15,23,42,0.75)"/>
            <path d="M -6 -39 C -3 -35, 3 -35, 6 -39"
                  fill="none" stroke="rgba(15,23,42,0.68)" stroke-width="2.2" stroke-linecap="round"/>
          </g>
        </g>
      `.trim();
    }

    // =========================
    // BUILD SVG (lanes, ticks, paths, runners)
    // =========================
    const svg = document.querySelector("svg");
    const lanesG = document.getElementById("lanes");
    const ticksG = document.getElementById("distanceTicks");
    const pathsG = document.getElementById("paths");
    const runnersG = document.getElementById("runners");
    const tracksDoneG = document.getElementById("tracksDone");

    // Dist√¢ncia: ticks a cada 50 pontos (0..300) -> 7 marcas (0,50,100,150,200,250,300)
    (function buildTicks(){
      const tickScores = [0,50,100,150,200,250,300];
      for(const s of tickScores){
        const p = s / MAX_SCORE;
        const x = X_START + (X_END - X_START) * p;
        const y1 = 82;
        const y2 = 560;
        const line = document.createElementNS("http://www.w3.org/2000/svg","line");
        line.setAttribute("x1", x);
        line.setAttribute("x2", x);
        line.setAttribute("y1", y1);
        line.setAttribute("y2", y2);
        line.setAttribute("stroke", "rgba(15,23,42,0.10)");
        line.setAttribute("stroke-width", (s % 100 === 0) ? "2" : "1");
        ticksG.appendChild(line);

        const label = document.createElementNS("http://www.w3.org/2000/svg","text");
        label.setAttribute("x", x);
        label.setAttribute("y", 590);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "12");
        label.setAttribute("fill", "rgba(15,23,42,0.45)");
        label.textContent = s;
        ticksG.appendChild(label);
      }
    })();

    // Raias + paths + corredores
    const lanePaths = [];
    const donePaths = [];
    const doneLens = [];
    for(let i=0;i<TEAMS;i++){
      const y = Y_TOP + i * Y_SPACING;

      // linha da raia
      const laneLine = document.createElementNS("http://www.w3.org/2000/svg","line");
      laneLine.setAttribute("x1", 90);
      laneLine.setAttribute("x2", 1010);
      laneLine.setAttribute("y1", y);
      laneLine.setAttribute("y2", y);
      laneLine.setAttribute("stroke", "rgba(15,23,42,0.10)");
      laneLine.setAttribute("stroke-width", "2");
      lanesG.appendChild(laneLine);

      // n√∫mero da raia
      const laneLabel = document.createElementNS("http://www.w3.org/2000/svg","text");
      laneLabel.setAttribute("x", 78);
      laneLabel.setAttribute("y", y + 4);
      laneLabel.setAttribute("text-anchor", "end");
      laneLabel.setAttribute("font-size", "12");
      laneLabel.setAttribute("fill", "rgba(15,23,42,0.55)");
      laneLabel.textContent = `#${i+1}`;
      lanesG.appendChild(laneLabel);

      // path individual
      const path = document.createElementNS("http://www.w3.org/2000/svg","path");
      path.setAttribute("id", `lanePath${i}`);
      path.setAttribute("d", buildLanePathD(i));
      path.setAttribute("fill", "none");
      path.setAttribute("stroke", "rgba(2,132,199,0.0)");
      path.setAttribute("stroke-width", "2");
      pathsG.appendChild(path);
      lanePaths.push(path);

      // rastro/progresso (mesma curva, com cor da equipe)
      const done = document.createElementNS("http://www.w3.org/2000/svg","path");
      done.setAttribute("id", `laneDone${i}`);
      done.setAttribute("d", path.getAttribute("d"));
      done.setAttribute("fill", "none");
      done.setAttribute("stroke", COLORS[i % COLORS.length]);
      done.setAttribute("stroke-width", "8");
      done.setAttribute("stroke-linecap", "round");
      done.setAttribute("opacity", "0.85");

      // ‚Äúdesenha‚Äù s√≥ o trecho percorrido via dash
      const len = path.getTotalLength();
      done.setAttribute("stroke-dasharray", `${len}`);
      done.setAttribute("stroke-dashoffset", `${len}`);

      tracksDoneG.appendChild(done);
      donePaths.push(done);
      doneLens.push(len);

      // runner group
      const runner = document.createElementNS("http://www.w3.org/2000/svg","g");
      runner.setAttribute("id", `runner${i}`);
      runner.setAttribute("filter", "url(#softShadow)");
      runner.innerHTML = minifigSVG(COLORS[i % COLORS.length]);
      runnersG.appendChild(runner);
    }

    // =========================
    // CONTROLS UI (13 inputs)
    // =========================
    const teamControls = document.getElementById("teamControls");
    const btnZero = document.getElementById("btnZero");
    const btnRandom = document.getElementById("btnRandom");

    const targets = Array(TEAMS).fill(0);
    const currents = Array(TEAMS).fill(0);

    function setTeamScore(i, val){
      const v = clamp(Math.round(Number(val)), MIN_SCORE, MAX_SCORE);
      targets[i] = v;

      // atualiza UI daquele card
      const num = document.getElementById(`scoreNum${i}`);
      const range = document.getElementById(`scoreRange${i}`);
      const label = document.getElementById(`scoreLabel${i}`);
      if(num) num.value = String(v);
      if(range) range.value = String(v);
      if(label) label.textContent = `${v} / ${MAX_SCORE}`;
    }

    // cria os 13 cards
    for(let i=0;i<TEAMS;i++){
      const card = document.createElement("div");
      card.className = "team-card";

      card.innerHTML = `
        <div class="team-head">
          <div class="team-name">
            <span class="dot" style="background:${COLORS[i % COLORS.length]}"></span>
            <div class="team-title">${TEAM_NAMES[i] ?? `Equipe ${i+1}`}</div>
          </div>
          <div class="team-score">
            <span id="scoreLabel${i}">0 / ${MAX_SCORE}</span>
          </div>
        </div>

        <div class="row">
          <input id="scoreNum${i}" type="number" min="${MIN_SCORE}" max="${MAX_SCORE}" step="1" value="0" />
          <div class="small">pontos</div>
        </div>

        <input id="scoreRange${i}" type="range" min="${MIN_SCORE}" max="${MAX_SCORE}" step="1" value="0" />
      `;

      teamControls.appendChild(card);

      // listeners
      const num = card.querySelector(`#scoreNum${i}`);
      const range = card.querySelector(`#scoreRange${i}`);

      num.addEventListener("input", () => setTeamScore(i, num.value));
      range.addEventListener("input", () => setTeamScore(i, range.value));
    }

    btnZero.addEventListener("click", () => {
      for(let i=0;i<TEAMS;i++) setTeamScore(i, 0);
    });

    btnRandom.addEventListener("click", () => {
      for(let i=0;i<TEAMS;i++){
        const r = Math.floor(Math.random() * (MAX_SCORE + 1));
        setTeamScore(i, r);
      }
    });

    // =========================
    // ANIMATION LOOP
    // =========================
    let lastT = performance.now();

function updateRunner(i, score){
  const progress = scoreToProgress(score);

  const path = lanePaths[i];
  const len = path.getTotalLength();
  const dist = progress * len;

  const p = path.getPointAtLength(dist);
  const p2 = path.getPointAtLength(Math.min(len, dist + 1));
  const angle = Math.atan2(p2.y - p.y, p2.x - p.x) * 180 / Math.PI;
  const lean = clamp(angle, -18, 18);

  // runner
  const runner = document.getElementById(`runner${i}`);
  const SCALE = 0.75;   // ajuste aqui (0.5 menor, 0.8 maior, 1.0 original)
const Y_OFFSET = 6;   // opcional: ‚Äúdesce‚Äù um pouco pra grudar na raia (teste 0..10)

runner.setAttribute(
  "transform",
  `translate(${p.x}, ${p.y + Y_OFFSET}) rotate(${lean}) scale(${SCALE})`
);


  // rastro (se existir)
  const done = donePaths?.[i];
  if(done){
    // usa o comprimento do pr√≥prio path do rastro
    const doneLen = doneLens?.[i] ?? done.getTotalLength();
    done.setAttribute("stroke-dashoffset", `${doneLen * (1 - progress)}`);
  }
}


    function tick(t){
      const dt = Math.min(0.05, (t - lastT) / 1000);
      lastT = t;

      // suaviza√ß√£o (independente do FPS)
      const smoothing = 1 - Math.pow(0.001, dt);

      for(let i=0;i<TEAMS;i++){
        currents[i] += (targets[i] - currents[i]) * smoothing;
        if(Math.abs(targets[i] - currents[i]) < 0.05) currents[i] = targets[i];
        updateRunner(i, currents[i]);
      }

      requestAnimationFrame(tick);
    }

    // init
    for(let i=0;i<TEAMS;i++){
      setTeamScore(i, 0);
      updateRunner(i, 0);
    }
    requestAnimationFrame(tick);

    (() => {
  const btn = document.getElementById("btnFireworks");
  const canvas = document.getElementById("fireworksCanvas");
  if(!btn || !canvas) return;

  const ctx = canvas.getContext("2d");

  function resize(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  window.addEventListener("resize", resize);
  resize();

  // Part√≠culas
  const sparks = [];
  const bursts = [];
  let running = false;
  let rafId = 0;
  let endAt = 0;

  function rand(min, max){ return min + Math.random() * (max - min); }

  function addBurst(x, y){
    // ‚Äúestouro‚Äù: cria v√°rias fa√≠scas
    const count = Math.floor(rand(70, 120));
    const hue = rand(0, 360);
    for(let i=0;i<count;i++){
      const ang = rand(0, Math.PI * 2);
      const spd = rand(2.5, 7.5);
      sparks.push({
        x, y,
        vx: Math.cos(ang) * spd,
        vy: Math.sin(ang) * spd,
        life: rand(0.9, 1.6),
        age: 0,
        hue: (hue + rand(-30, 30) + 360) % 360,
        size: rand(1.2, 2.6)
      });
    }
    // brilho central sutil
    bursts.push({ x, y, r: 0, max: rand(40, 80), a: 0.6 });
  }

  function launchShow(durationMs = 2200){
    // dispara v√°rias explos√µes ao longo do tempo
    const start = performance.now();
    endAt = start + durationMs;

    // agenda 8‚Äì14 explos√µes
    const n = Math.floor(rand(8, 14));
    for(let i=0;i<n;i++){
      const t = rand(0, durationMs * 0.9);
      setTimeout(() => {
        const x = rand(window.innerWidth * 0.15, window.innerWidth * 0.85);
        const y = rand(window.innerHeight * 0.12, window.innerHeight * 0.45);
        addBurst(x, y);
        // pequena chance de ‚Äúduplo‚Äù:
        if(Math.random() < 0.35) addBurst(x + rand(-60, 60), y + rand(-40, 40));
        startLoop();
      }, t);
    }
    startLoop();
  }

  function startLoop(){
    if(running) return;
    running = true;
    rafId = requestAnimationFrame(tick);
  }

  function tick(t){
    // fundo com ‚Äúfade‚Äù pra trilhas (sem limpar seco)
    ctx.fillStyle = "rgba(255,255,255,0.08)";
    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);

    // anima glow central
    for(let i=bursts.length-1;i>=0;i--){
      const b = bursts[i];
      b.r += 3.2;
      b.a *= 0.94;
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
      ctx.strokeStyle = `rgba(255,255,255,${b.a})`;
      ctx.lineWidth = 2;
      ctx.stroke();
      if(b.r > b.max || b.a < 0.02) bursts.splice(i, 1);
    }

    // f√≠sica das fa√≠scas
    const gravity = 0.06;
    for(let i=sparks.length-1;i>=0;i--){
      const p = sparks[i];
      p.age += 1/60;
      p.vy += gravity;
      p.vx *= 0.99;
      p.vy *= 0.99;
      p.x += p.vx;
      p.y += p.vy;

      const lifeLeft = 1 - (p.age / p.life);
      if(lifeLeft <= 0){
        sparks.splice(i, 1);
        continue;
      }

      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fillStyle = `hsla(${p.hue}, 95%, 55%, ${Math.max(0, lifeLeft)})`;
      ctx.fill();
    }

    const shouldStop = (t > endAt) && sparks.length === 0 && bursts.length === 0;

    if(shouldStop){
      running = false;
      ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
      cancelAnimationFrame(rafId);
      return;
    }

    rafId = requestAnimationFrame(tick);
  }

  btn.addEventListener("click", () => {
    // limpa e dispara novo show
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    sparks.length = 0;
    bursts.length = 0;
    launchShow(2600);
  });
})();

  </script>
</body>
</html>
